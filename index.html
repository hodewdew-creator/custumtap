<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>BPM counter</title>
  <style>
    :root{ --accent:#69b10d; }
    body{ font-family:sans-serif; margin:0; background:#f9fafb; }
    .pad{ flex:1; display:flex; align-items:center; justify-content:center; border:6px solid var(--accent); margin:20px; border-radius:14px; }
    .pad-label{ font-size:100px; font-weight:900; color:var(--accent); }
    .bottom{ display:flex; gap:10px; margin:20px; }
    .btn{ flex:1; height:50px; font-size:18px; font-weight:800; border:none; border-radius:12px; cursor:pointer; }
    .btn.primary{ background:var(--accent); color:#fff; }
    .btn.secondary{ background:#eee; }
    dialog{ width:min(500px,90vw); border:none; border-radius:14px; padding:16px; }
    .row{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .row label{ width:120px; }
    .chips{ display:flex; flex-wrap:wrap; gap:6px; }
    .chip{ width:28px; height:28px; border-radius:6px; cursor:pointer; border:1px solid #ccc; }
  </style>
</head>
<body>
  <div class="pad" id="pad"><div class="pad-label" id="padLabel">TAP!</div></div>
  <div class="bottom">
    <button class="btn primary" id="resetBtn">RESET</button>
    <button class="btn secondary" id="customBtn">custom</button>
  </div>

  <dialog id="settings">
    <h3>Personal interface</h3>
    <div class="row">
      <label>Theme color</label>
      <input type="color" id="themeColor" value="#69b10d">
    </div>
    <div class="row">
      <label>Presets</label>
      <div class="chips">
        <div class="chip" style="background:#69b10d" data-color="#69b10d"></div>
        <div class="chip" style="background:#003399" data-color="#003399"></div>
        <div class="chip" style="background:#CC6699" data-color="#CC6699"></div>
        <div class="chip" style="background:#ff6600" data-color="#ff6600"></div>
      </div>
    </div>
    <div class="row">
      <label>Background</label>
      <input type="file" id="bgFile" accept="image/*">
    </div>
    <div style="text-align:right; margin-top:12px;">
      <button class="btn secondary" id="resetSettings">Reset</button>
      <button class="btn secondary" id="closeSettings">Cancel</button>
      <button class="btn primary" id="saveSettings">Save</button>
    </div>
  </dialog>

<script>
const pad=document.getElementById('pad');
const padLabel=document.getElementById('padLabel');
const resetBtn=document.getElementById('resetBtn');
const customBtn=document.getElementById('customBtn');
const dlg=document.getElementById('settings');
const themeColor=document.getElementById('themeColor');
const chips=document.querySelectorAll('.chip');
const saveSettings=document.getElementById('saveSettings');
const closeSettings=document.getElementById('closeSettings');
const resetSettings=document.getElementById('resetSettings');
const bgFile=document.getElementById('bgFile');

let prefs={accent:'#69b10d',bg:null};

function applyTheme(hex){ document.documentElement.style.setProperty('--accent',hex); themeColor.value=hex; prefs.accent=hex; }
function savePrefs(){ localStorage.setItem('bpm_prefs_v1',JSON.stringify(prefs)); }
function loadPrefs(){ const raw=localStorage.getItem('bpm_prefs_v1'); if(raw){ prefs=JSON.parse(raw); applyTheme(prefs.accent); if(prefs.bg) document.body.style.backgroundImage='url('+prefs.bg+')'; }}

chips.forEach(chip=> chip.addEventListener('click',()=>{ applyTheme(chip.dataset.color); }));

customBtn.addEventListener('click',()=> dlg.showModal());
saveSettings.addEventListener('click',()=>{ savePrefs(); dlg.close(); });
closeSettings.addEventListener('click',()=> dlg.close());

// 설정 초기화(설정 화면의 Reset 버튼)
if (resetSettings) {
  resetSettings.addEventListener('click',()=>{
    const ok = confirm('정말 설정을 초기화할까요?
테마 색상과 배경이미지가 기본값으로 돌아갑니다.');
    if(!ok) return;
    localStorage.removeItem('bpm_prefs_v1');
    prefs={accent:'#69b10d',bg:null};
    applyTheme(prefs.accent);
    document.body.style.backgroundImage='none';
    if (bgFile) bgFile.value='';
    themeColor.value=prefs.accent;
    savePrefs();
  });
}

bgFile.addEventListener('change',()=>{ const f=bgFile.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ prefs.bg=r.result; document.body.style.backgroundImage='url('+r.result+')'; }; r.readAsDataURL(f); });

resetBtn.addEventListener('click',()=>{
  // 메인 화면 리셋: 측정값만 초기화 (테마/배경은 보존)
  padLabel.textContent='TAP!';
}); prefs={accent:'#69b10d',bg:null}; applyTheme(prefs.accent); document.body.style.backgroundImage='none'; padLabel.textContent='TAP!';
  }
});

loadPrefs();
</script>
</body>
</html>


